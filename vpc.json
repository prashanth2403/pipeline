{
   "AWSTemplateFormatVersion":"2010-09-09",
   "Description":"Creates VPC with public and private subnets",
   "Resources":{
      "PubPrivateVPC":{
         "Type":"AWS::EC2::VPC",
         "Properties":{
            "CidrBlock":{"Ref":"vpccidr"},
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Ref":"EnvironmentName"
                  }
               },
               {
                  "Key":"SubscribingVpc",
                  "Value":"YES"
               }
            ]
         }
      },
      "PublicSubnet1":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"PubPrivateVPC"
            },
            "AvailabilityZone":"us-east-1a",
            "CidrBlock":{ "Ref": "publicsubnet1"},
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        "-",
                        [
                           {
                              "Ref":"EnvironmentName"
                           },
                           "FrontEnd-1"
                        ]
                     ]
                  }
               }
            ],
            "MapPublicIpOnLaunch":false
         }
      },
      "PublicSubnet2":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"PubPrivateVPC"
            },
            "AvailabilityZone":"us-east-1b",
            "CidrBlock":{"Ref": "publicsubnet2"},
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        "-",
                        [
                           {
                              "Ref":"EnvironmentName"
                           },
                           "FrontEnd-2"
                        ]
                     ]
                  }
               }
            ],
            "MapPublicIpOnLaunch":false
         }
      },
      "PublicSubnet3":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"PubPrivateVPC"
            },
            "AvailabilityZone":"us-east-1c",
            "CidrBlock":{"Ref": "publicsubnet3"},
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        "-",
                        [
                           {
                              "Ref":"EnvironmentName"
                           },
                           "FrontEnd-3"
                        ]
                     ]
                  }
               }
            ],
            "MapPublicIpOnLaunch":false
         }
      },
      "PrivateSubnet1":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"PubPrivateVPC"
            },
            "AvailabilityZone":"us-east-1a",
            "CidrBlock":{"Ref":"privatesubnet1"},
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        "-",
                        [
                           {
                              "Ref":"EnvironmentName"
                           },
                           "Private-wo-Reachback-1"
                        ]
                     ]
                  }
               }
            ],
            "MapPublicIpOnLaunch":false
         }
      },
      "PrivateSubnet2":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"PubPrivateVPC"
            },
            "AvailabilityZone":"us-east-1b",
            "CidrBlock":{"Ref": "privatesubnet2"},
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        "-",
                        [
                           {
                              "Ref":"EnvironmentName"
                           },
                           "Private-wo-Reachback-2"
                        ]
                     ]
                  }
               }
            ],
            "MapPublicIpOnLaunch":false
         }
      },
      "PrivateSubnet3":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"PubPrivateVPC"
            },
            "AvailabilityZone":"us-east-1c",
            "CidrBlock":{"Ref":"privatesubnet3"},
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        "-",
                        [
                           {
                              "Ref":"EnvironmentName"
                           },
                           "Private-wo-Reachback-3"
                        ]
                     ]
                  }
               }
            ],
            "MapPublicIpOnLaunch":false
         }
      },
      "PrivateSubnet4":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"PubPrivateVPC"
            },
            "AvailabilityZone":"us-east-1a",
            "CidrBlock":{"Ref":"privatesubnet4"},
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        "-",
                        [
                           {
                              "Ref":"EnvironmentName"
                           },
                           "Private-w-Reachback-1"
                        ]
                     ]
                  }
               }
            ],
            "MapPublicIpOnLaunch":false
         }
      },
      "PrivateSubnet5":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"PubPrivateVPC"
            },
            "AvailabilityZone":"us-east-1b",
            "CidrBlock":{"Ref":"privatesubnet5"},
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        "-",
                        [
                           {
                              "Ref":"EnvironmentName"
                           },
                           "Private-w-Reachback-2"
                        ]
                     ]
                  }
               }
            ],
            "MapPublicIpOnLaunch":false
         }
      },
      "PrivateSubnet6":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"PubPrivateVPC"
            },
            "AvailabilityZone":"us-east-1c",
            "CidrBlock":{"Ref":"privatesubnet6"},
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        "-",
                        [
                           {
                              "Ref":"EnvironmentName"
                           },
                           "Private-w-Reachback-3"
                        ]
                     ]
                  }
               }
            ],
            "MapPublicIpOnLaunch":false
         }
      },
      "InternetGateway":{
         "Type":"AWS::EC2::InternetGateway",
         "Properties":{
            "Tags":[
               {
                  "Key":"Name",
                  "Value":{
                     "Fn::Join":[
                        "_",
                        [
                           {
                              "Ref":"AWS::StackName"
                           }
                        ]
                     ]
                  }
               },
               {
                  "Key":"Network",
                  "Value":"Public"
               }
            ]
         }
      },
      "GatewayToInternet":{
         "Type":"AWS::EC2::VPCGatewayAttachment",
         "Properties":{
            "VpcId":{
               "Ref":"PubPrivateVPC"
            },
            "InternetGatewayId":{
               "Ref":"InternetGateway"
            }
         }
      },
      "PublicRouteTable":{
         "Type":"AWS::EC2::RouteTable",
         "Properties":{
            "VpcId":{
               "Ref":"PubPrivateVPC"
            },
            "Tags":[
               {
                  "Key":"Network",
                  "Value":"Public"
               },
               {
                  "Key":"Name",
                  "Value":"Lab-FrontEndRouteTable"
               }
            ]
         }
      },
      "PublicRoute":{
         "Type":"AWS::EC2::Route",
         "Properties":{
            "RouteTableId":{
               "Ref":"PublicRouteTable"
            },
            "DestinationCidrBlock":"0.0.0.0/0",
            "GatewayId":{
               "Ref":"InternetGateway"
            }
         }
      },
      "PublicSubnet1RouteTableAssociation":{
         "Type":"AWS::EC2::SubnetRouteTableAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"PublicSubnet1"
            },
            "RouteTableId":{
               "Ref":"PublicRouteTable"
            }
         }
      },
      "PublicSubnet2RouteTableAssociation":{
         "Type":"AWS::EC2::SubnetRouteTableAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"PublicSubnet2"
            },
            "RouteTableId":{
               "Ref":"PublicRouteTable"
            }
         }
      },
      "PublicSubnet3RouteTableAssociation":{
         "Type":"AWS::EC2::SubnetRouteTableAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"PublicSubnet3"
            },
            "RouteTableId":{
               "Ref":"PublicRouteTable"
            }
         }
      },
      "PrivateRouteTable":{
         "Type":"AWS::EC2::RouteTable",
         "Properties":{
            "VpcId":{
               "Ref":"PubPrivateVPC"
            },
            "Tags":[
               {
                  "Key":"Network",
                  "Value":"Private"
               },
               {
                  "Key":"Name",
                  "Value":"Lab-PrivateRouteTable"
               }
            ]
         }
      },
      "PrivateSubnet1RouteTableAssociation":{
         "Type":"AWS::EC2::SubnetRouteTableAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"PrivateSubnet1"
            },
            "RouteTableId":{
               "Ref":"PrivateRouteTable"
            }
         }
      },
      "PrivateSubnet2RouteTableAssociation":{
         "Type":"AWS::EC2::SubnetRouteTableAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"PrivateSubnet2"
            },
            "RouteTableId":{
               "Ref":"PrivateRouteTable"
            }
         }
      },
      "PrivateSubnet3RouteTableAssociation":{
         "Type":"AWS::EC2::SubnetRouteTableAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"PrivateSubnet3"
            },
            "RouteTableId":{
               "Ref":"PrivateRouteTable"
            }
         }
      },
      "PrivateSubnet4RouteTableAssociation":{
         "Type":"AWS::EC2::SubnetRouteTableAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"PrivateSubnet4"
            },
            "RouteTableId":{
               "Ref":"PrivateRouteTable"
            }
         }
      },
      "PrivateSubnet5RouteTableAssociation":{
         "Type":"AWS::EC2::SubnetRouteTableAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"PrivateSubnet5"
            },
            "RouteTableId":{
               "Ref":"PrivateRouteTable"
            }
         }
      },
      "PrivateSubnet6RouteTableAssociation":{
         "Type":"AWS::EC2::SubnetRouteTableAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"PrivateSubnet6"
            },
            "RouteTableId":{
               "Ref":"PrivateRouteTable"
            }
         }
      }
   }
}
